{{- define "Message"}}
type {{.Name}} struct {
    {{- range $field := .Fields }}
    {{ $field.Name }} {{ $field.Type }} `{{- $field.MarshalledTag }}`
    {{- end }} 
}

{{template "MessageMethods" .}}
{{template "EncodeMethod" .}}
{{template "DecodeMethod" .}}
{{template "IsZeroMethod" .}}
{{template "Init" .}}
{{- end}}

{{- define "MessageMethods"}}
func (x *{{.Name}}) New() codecs.Reflected {
    return new({{.Name}})
}

func (x *{{.Name}}) Type() metadata.Type {
    return metadata.CaptureTypeByName("{{.TypeName}}")
}
{{- end}}

{{- define "Init"}}
func init() {
    metadata.RegisterTypeAs[{{.Name}}]("{{.TypeName}}")
}
{{- end}}